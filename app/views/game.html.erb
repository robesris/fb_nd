<style>
  .row {
    clear: both;
  }

  .left {
    float: left;
  }

  .clear {
    clear: both;
  }

  .draft_piece {
    width: 100px;
  }

  .keep_space {
    width: 100px;
  }

  .board_space {
    width: 100px;
  }
</style>

<%= link_to "New Game", create_game_path %>

<% if @game %>

  <%= form_for @game do |f| %>
    <%= f.radio_button :active_player, :go_first %>Go first

    <%= button_tag "Ready", :type => :button %>
    <%= button_tag "Start", :type => :button %>

    <%= fields_for :player1 do |p| %>
      <%= p.text_field :crystals, :value => @game.player1.crystals %>
    <% end %>

    <%= fields_for :player2 do |p| %>
      <%= p.text_field :crystals, :value => @game.player2.crystals %>
    <% end %>

    <% @all_piece_klasses.each do |klass| %>
      <div id="draft_<%= klass.to_s.downcase %>" name="<%= klass.to_s %>" class="draft_piece"><%= klass.to_s %></div>
    <% end %>

    <% 1.upto(2) do |pnum| %>
      <div id="keep_<%= pnum %>" class="clear">
        <% 1.upto(7) do |n| %>
          <div id="keep_<%= pnum %>_<%= n %>" class="keep_space left">P<%= pnum %>K<%= n %></div>
        <% end %>
      </div>
    <% end %>

    <div>
      <% 7.downto(1) do |row| %>
        <div class="row">
          <% 'a'.upto('g') do |col| %>
            <div class="col left">
              <div id='space_<%= col + '_' + row.to_s %>' class='board_space'>
                <%= col + '_' + row.to_s %>
                <% if piece = @game.board.space(col, row).piece %>
                  <div name='<%= piece.name %>' class='player<%= piece.player.num %> piece'>
                    P<%= piece.player.num %>: <%= piece.name %>
                  </div>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  <% end %>

<% end %>

<script>
  $(function() {
    //var 

    $('.draft_piece, .piece').draggable();
    $( ".board_space, .keep_space" ).droppable({
      drop: function( event, ui ) {
        //console.log(this);
        //console.log(ui);
        var new_piece = $(ui.draggable).clone();
        new_piece.css('left', 0).css('top', 0).attr('class', 'player1').draggable();
        $( this )
          .addClass( "ui-state-highlight" )
					.append(new_piece);
      }
    });
  });
</script>
